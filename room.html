<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>الغرفة الصوتية</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="room.css">
  <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
  <div class="room-container">
    <header class="room-header">
      <div id="room-name">🎤 <strong>غرفة رقم 1</strong></div>
      <div class="header-center">
        <div id="user-count">👥 المتصلين: <span id="user-total">1</span></div>
        <div id="live-clock">🕒 <span id="clock-time">00:00:00</span></div>
      </div>
      <div id="user-profile" onclick="toggleProfileMenu()">
        <span id="username-display"></span>
        <img id="user-avatar" src="https://i.pravatar.cc/32" alt="User Avatar">
        <div id="profile-menu" class="dropdown-menu" style="display: none;">
          <a href="javascript:void(0)" onclick="showProfileModal()">ملفي الشخصي</a>
          <a href="javascript:void(0)" onclick="showSettingsModal()">الإعدادات</a>
          <a href="javascript:void(0)" onclick="logoutUser()">تسجيل الخروج</a>
        </div>
      </div>
    </header>

    <main class="room-main">
      <div id="mics-container">
        <div id="mics">
          <div class="mic" onclick="showUserInfo('أحمد', 'ID-1023'); playMicSound();">🎤 أحمد</div>
          <div class="mic" onclick="showUserInfo('ليلى', 'ID-2041'); playMicSound();">🎤 ليلى</div>
          <div class="mic" onclick="showUserInfo('سارة', 'ID-3052'); playMicSound();">🎤 سارة</div>
        </div>
      </div>

      <div id="chat-box">
        <div id="messages"></div>
        <div class="chat-input">
          <input id="msg-input" type="text" placeholder="اكتب رسالتك...">
          <button onclick="sendMessage()">إرسال</button>
        </div>
      </div>

      <aside class="online-sidebar">
        <h3>المتصلون</h3>
        <ul id="online-users-list">
          <!-- Users will be populated by JavaScript -->
        </ul>
      </aside>
    </main>

    <footer class="room-footer">
      <div id="current-user-info">
        <img id="current-user-avatar" src="https://i.pravatar.cc/32" alt="My Avatar">
        <span id="current-username-display"></span>
      </div>
      <div id="controls-toolbar">
        <button onclick="toggleDarkMode()" title="الوضع الليلي">🌙</button>
        <button onclick="toggleMusic()" title="موسيقى">🎵</button>
        <button onclick="sendGift()" title="إرسال هدية">🎁</button>
        <button id="share-button" onclick="copyRoomLink()" title="مشاركة الغرفة">🔗</button>
        <button onclick="changeBackground()" title="تغيير الخلفية">🖼️</button>
        <button id="admin-panel-button" onclick="showAdminControls()" title="أدوات الإشراف" style="display: none;">🛡️</button>
        <button onclick="exitRoom()" title="خروج">🚪</button>
      </div>
    </footer>

  </div>

  <!-- Background Selection Modal -->
  <div id="background-modal" class="popup" style="display: none;">
    <div class="popup-content">
      <div class="popup-header">
        <h3>تغيير خلفية الغرفة</h3>
        <button id="close-background-modal" class="close-button">❌</button>
      </div>
      <div class="popup-body">
        <h4>رفع صورة من جهازك</h4>
        <input type="file" id="background-upload-input" accept="image/*">

        <hr>

        <h4>أو اختر من الخلفيات الجاهزة</h4>
        <div id="preset-backgrounds-gallery" class="gallery">
          <!-- Preset images will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- Popups and other hidden elements -->
  <div id="user-info-popup" class="popup">
    <div class="popup-content">
      <p id="user-name">👤 الاسم: </p>
      <p id="user-id">🆔 ID: </p>
      <button onclick="copyUserId()">📋 نسخ ID</button>
      <button onclick="closePopup()">❌ إغلاق</button>
    </div>
  </div>

  <div id="admin-controls" class="popup" style="display:none;">
      <div class="popup-content">
        <div class="popup-header">
          <h3>أدوات الإشراف</h3>
          <button onclick="closeAdminControls()" class="close-button">❌</button>
        </div>
        <button onclick="muteAllUsers()">🔇 كتم الجميع</button>
        <button onclick="makeAnnouncement()">📣 إعلان</button>
        <button onclick="assignModerator()">🛡️ تعيين مشرف</button>
        <button onclick="banUser()">🚫 حظر مستخدم</button>
        <button onclick="reportUser()">⚠️ تبليغ عن مستخدم</button>
      </div>
  </div>

  <div id="toast"></div>

  <!-- Gift Modal -->
  <div id="gift-modal" class="popup" style="display: none;">
    <div class="popup-content">
      <h3>إرسال هدية</h3>
      <div class="gift-options">
        <span class="gift-option" onclick="selectGift('🎁')">🎁</span>
        <span class="gift-option" onclick="selectGift('❤️')">❤️</span>
        <span class="gift-option" onclick="selectGift('⭐')">⭐</span>
        <span class="gift-option" onclick="selectGift('💎')">💎</span>
      </div>
      <button onclick="closeGiftModal()">إغلاق</button>
    </div>
  </div>

  <!-- Profile Modal -->
  <div id="profile-modal" class="popup" style="display: none;">
    <div class="popup-content">
      <div class="popup-header">
        <h3>ملفي الشخصي</h3>
        <button onclick="closeProfileModal()" class="close-button">❌</button>
      </div>
      <div class="popup-body profile-body">
        <img id="profile-modal-avatar" src="https://i.pravatar.cc/96" alt="User Avatar">
        <h4 id="profile-modal-name"></h4>
        <p>ID: <span id="profile-modal-id"></span></p>
        <p>الحالة: <span class="user-status online"></span> متصل</p>
        <button>تعديل الملف الشخصي</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="popup" style="display: none;">
    <div class="popup-content">
      <div class="popup-header">
        <h3>الإعدادات</h3>
        <button onclick="closeSettingsModal()" class="close-button">❌</button>
      </div>
      <div class="popup-body settings-body">
        <div class="setting-item">
          <label for="dark-mode-toggle">الوضع الليلي</label>
          <button onclick="toggleDarkMode()">تبديل 🌙</button>
        </div>
        <div class="setting-item">
          <label for="music-toggle">موسيقى الخلفية</label>
          <button onclick="toggleMusic()">تشغيل/إيقاف 🎵</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Kick Confirmation Modal -->
  <div id="kick-confirm-modal" class="popup" style="display: none;">
    <div class="popup-content">
      <div class="popup-header">
        <h3>تأكيد الطرد</h3>
        <button onclick="closeKickModal()" class="close-button">❌</button>
      </div>
      <p>هل أنت متأكد من رغبتك في طرد المستخدم <strong id="kick-user-name"></strong>؟</p>
      <div class="kick-confirm-actions">
        <button id="confirm-kick-btn" onclick="banUser()" class="destructive-btn">نعم، قم بالطرد</button>
        <button onclick="closeKickModal()">إلغاء</button>
      </div>
    </div>
  </div>

  <!-- Audio elements -->
  <audio id="mic-audio" src="mic-sound.mp3"></audio>
  <audio id="bg-music" src="bg-music.mp3" loop></audio>
  <audio id="newMessageSound" src="new-message.mp3" preload="auto"></audio>
  <audio id="welcomeSound" src="welcome.mp3" preload="auto"></audio>

  <script src="room.js"></script>
</body>
</html>
